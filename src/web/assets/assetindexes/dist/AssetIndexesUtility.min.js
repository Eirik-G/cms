!function(t){var s={};function e(i){if(s[i])return s[i].exports;var o=s[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=s,e.d=function(t,s,i){e.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:i})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,s){if(1&s&&(t=e(t)),8&s)return t;if(4&s&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&s&&"string"!=typeof t)for(var o in t)e.d(i,o,function(s){return t[s]}.bind(null,o));return i},e.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(s,"a",s),s},e.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},e.p="",e(e.s=0)}([function(t,s){var e;e=jQuery,Craft.AssetIndexesUtility=Garnish.Base.extend({$trigger:null,$form:null,totalActions:null,completedActions:null,loadingActions:null,queue:null,cacheImages:!1,sessionId:null,init:function(t){this.$form=e("#"+t),this.$trigger=e("input.submit",this.$form),this.$status=e(".utility-status",this.$form),this.addListener(this.$form,"submit","onSubmit")},onSubmit:function(t){t.preventDefault(),this.$trigger.hasClass("disabled")||(this.progressBar?this.progressBar.resetProgressBar():this.progressBar=new Craft.ProgressBar(this.$status,!0),this.totalActions=0,this.loadingActions=0,this.completedActions=0,this.queue=[],this.progressBar.$progressBar.removeClass("hidden"),this.progressBar.$progressBarStatus.removeClass("hidden"),this.progressBar.$progressBar.velocity("stop").velocity({opacity:1},{complete:e.proxy((function(){var t=Garnish.getPostData(this.$form),s=Craft.expandPostArray(t);s.start=!0,this.cacheImages=s.cacheImages,Craft.postActionRequest("utilities/asset-index-perform-action",{params:s},function(t){if(t.indexingData){this.sessionId=t.indexingData.sessionId;for(var s=0;s<t.indexingData.volumes.length;s++)for(var e=t.indexingData.volumes[s],i=0;i<e.total;i++)this.queue.push({process:!0,sessionId:this.sessionId,volumeId:e.volumeId,cacheImages:this.cacheImages}),this.totalActions++;this.totalActions>0?this.processIndexing():this.finishIndexing()}}.bind(this))}),this)}),this.$allDone&&this.$allDone.css("opacity",0),this.$trigger.addClass("disabled"),this.$trigger.trigger("blur"))},updateProgressBar:function(){this.progressBar.setItemCount(this.totalActions),this.progressBar.setProcessedItemCount(this.completedActions),this.progressBar.updateProgressBar()},processIndexing:function(){if(this.completedActions+this.loadingActions<this.totalActions&&this.loadingActions<Craft.AssetIndexesUtility.maxConcurrentActions){this.loadingActions++;var t=this.queue.shift();Craft.postActionRequest("utilities/asset-index-perform-action",{params:t},function(t){this.loadingActions--,this.completedActions++,this.updateProgressBar(),t&&t.error&&alert(t.error),this.completedActions==this.totalActions?this.finishIndexing():this.processIndexing()}.bind(this)),this.processIndexing()}},showConfirmDialog:function(t){var s=e('<form class="modal fitted confirmmodal"/>').appendTo(Garnish.$bod),i=e('<div class="body"/>').appendTo(s).html(t.confirm),o=e('<footer class="footer"/>').appendTo(s),n=e('<div class="buttons right"/>').appendTo(o);if(t.showDelete){var r=e("<button/>",{type:"button",class:"btn",text:Craft.t("app","Keep them")}).appendTo(n);e("<button/>",{type:"submit",class:"btn submit",text:Craft.t("app","Delete them")}).appendTo(n),this.addListener(r,"click",(function(){a.hide(),this.onComplete()}))}else e("<button/>",{type:"submit",class:"btn submit",text:Craft.t("app","OK")}).appendTo(n);Craft.initUiElements(i);var a=new Garnish.Modal(s,{hideOnEsc:!1,hideOnShadeClick:!1,onHide:e.proxy(this,"onActionResponse")});this.addListener(s,"submit",(function(s){s.preventDefault(),a.settings.onHide=e.noop,a.hide();var o=Garnish.getPostData(i),n=Craft.expandPostArray(o);e.extend(n,t.params),n.finish=!0,Craft.postActionRequest("utilities/asset-index-perform-action",{params:n},e.noop),this.onComplete()}))},finishIndexing:function(){var t={sessionId:this.sessionId,overview:!0};Craft.postActionRequest("utilities/asset-index-perform-action",{params:t},function(t){t.confirm?(this.hideProgressBar(),this.showConfirmDialog(t)):this.onComplete()}.bind(this))},hideProgressBar:function(){this.progressBar.$progressBarStatus.addClass("hidden"),this.progressBar.$progressBar.velocity({opacity:0},{duration:"fast"})},onComplete:function(){this.hideProgressBar(),this.$allDone||(this.$allDone=e('<div class="alldone" data-icon="done" />').appendTo(this.$status),this.$allDone.css("opacity",0),this.$allDone.velocity({opacity:1},{duration:"fast"}),this.$trigger.removeClass("disabled"),this.$trigger.trigger("focus"))}},{maxConcurrentActions:3})}]);
//# sourceMappingURL=AssetIndexesUtility.min.js.map
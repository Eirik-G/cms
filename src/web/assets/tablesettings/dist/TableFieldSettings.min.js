!function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e){!function(t){Craft.TableFieldSettings=Garnish.Base.extend({columnsTableName:null,defaultsTableName:null,columnsData:null,columnsTableId:null,defaultsTableId:null,columnsTableInputPath:null,defaultsTableInputPath:null,defaults:null,columnSettings:null,dropdownSettingsHtml:null,dropdownSettingsCols:null,columnsTable:null,defaultsTable:null,init:function(t,e,n,i,s,a,l){this.columnsTableName=t,this.defaultsTableName=e,this.columnsData=n,this.columnsTableId=Craft.formatInputId(this.columnsTableName),this.defaultsTableId=Craft.formatInputId(this.defaultsTableName),this.columnsTableInputPath=Craft.filterArray(this.columnsTableName.split(/[\[\]]+/)),this.defaultsTableInputPath=Craft.filterArray(this.defaultsTableName.split(/[\[\]]+/)),this.defaults=i,this.columnSettings=s,this.dropdownSettingsHtml=a,this.dropdownSettingsCols=l,this.initColumnsTable(),this.initDefaultsTable()},initColumnsTable:function(){this.columnsTable=new e(this,this.columnsTableId,this.columnsTableName,this.columnSettings,{rowIdPrefix:"col",defaultValues:{type:"singleline"},onAddRow:t.proxy(this,"onAddColumn"),onDeleteRow:t.proxy(this,"reconstructDefaultsTable")})},initDefaultsTable:function(){this.defaultsTable=new Craft.EditableTable(this.defaultsTableId,this.defaultsTableName,this.columnsData,{rowIdPrefix:"row"})},onAddColumn:function(t){this.reconstructDefaultsTable(),this.initColumnSettingInputs(t)},initColumnSettingInputs:function(t){var e=t.find("td:first-child textarea, td:nth-child(3) textarea");this.addListener(e,"input","reconstructDefaultsTable")},reconstructDefaultsTable:function(){this.columnsData=Craft.expandPostArray(Garnish.getPostData(this.columnsTable.$tbody));var e,n,i=Craft.expandPostArray(Garnish.getPostData(this.defaultsTable.$tbody));for(e=0;e<this.columnsTableInputPath.length;e++)n=this.columnsTableInputPath[e],this.columnsData=this.columnsData[n];for(var s in this.columnsData)if(this.columnsData.hasOwnProperty(s)&&"select"===this.columnsData[s].type){var a=this.columnsTable.$tbody.find('tr[data-id="'+s+'"]').data("editable-table-row");this.columnsData[s].options=a.options||[]}for(e=0;e<this.defaultsTableInputPath.length;e++){if(void 0===i[n=this.defaultsTableInputPath[e]]){i={};break}i=i[n]}var l="<thead><tr>";for(var o in this.columnsData)this.columnsData.hasOwnProperty(o)&&(l+='<th scope="col">'+(this.columnsData[o].heading?this.columnsData[o].heading:"&nbsp;")+"</th>");l+='<th colspan="2"></th></tr></thead>';var d=t("<table/>",{id:this.defaultsTableId,class:"editable fullwidth"}).append(l),u=t("<tbody/>").appendTo(d);for(var r in i)i.hasOwnProperty(r)&&Craft.EditableTable.createRow(r,this.columnsData,this.defaultsTableName,i[r]).appendTo(u);this.defaultsTable.$table.replaceWith(d),this.defaultsTable.destroy(),delete this.defaultsTable,this.initDefaultsTable()}});var e=Craft.EditableTable.extend({fieldSettings:null,init:function(t,e,n,i,s){this.fieldSettings=t,this.base(e,n,i,s)},initialize:function(){return!!this.base()&&(this.fieldSettings.initColumnSettingInputs(this.$tbody),this.sorter.settings.onSortChange=t.proxy(this.fieldSettings.reconstructDefaultsTable,this.fieldSettings),!0)},createRowObj:function(t){return new e.Row(this,t)}});e.Row=Craft.EditableTable.Row.extend({$typeSelect:null,$settingsBtn:null,options:null,settingsModal:null,optionsTable:null,init:function(e,n){this.base(e,n),this.table.fieldSettings.columnsData[this.id]&&(this.options=this.table.fieldSettings.columnsData[this.id].options||null);var i=this.$tr.find("td:nth-child(4)"),s=i.find(".select");this.$settingsBtn=i.find(".settings"),this.$settingsBtn.length||(this.$settingsBtn=t("<a/>",{class:"settings light invisible",role:"button","data-icon":"settings"}),t("<div/>",{class:"flex flex-nowrap"}).appendTo(i).append(s).append(this.$settingsBtn)),this.$typeSelect=s.find("select"),this.addListener(this.$typeSelect,"change","handleTypeChange"),this.addListener(this.$settingsBtn,"click","showSettingsModal"),this.addListener(this.$tr.closest("form"),"submit","handleFormSubmit")},handleTypeChange:function(){"select"===this.$typeSelect.val()?this.$settingsBtn.removeClass("invisible"):this.$settingsBtn.addClass("invisible"),this.table.fieldSettings.reconstructDefaultsTable()},showSettingsModal:function(e){if(this.settingsModal)this.settingsModal.show();else{var n="dropdownsettingsmodal"+Math.floor(1e6*Math.random()),i=t("<div/>",{class:"modal dropdownsettingsmodal"}).appendTo(Garnish.$bod),s=t("<div/>",{class:"body"}).appendTo(i).html(this.table.fieldSettings.dropdownSettingsHtml.replace(/__ID__/g,n));if(this.optionsTable=new Craft.EditableTable(n,"__NAME__",this.table.fieldSettings.dropdownSettingsCols,{onAddRow:t.proxy(this,"handleOptionsRowChange"),onDeleteRow:t.proxy(this,"handleOptionsRowChange")}),this.options&&this.options.length)for(var a,l=0;l<this.options.length;l++)(a=this.optionsTable.addRow(!1)).$tr.find(".option-label textarea").val(this.options[l].label),a.$tr.find(".option-value textarea").val(this.options[l].value),a.$tr.find('.option-default input[type="checkbox"]').prop("checked",!!this.options[l].default);else this.optionsTable.addRow(!1);var o=t("<button/>",{type:"button",class:"btn submit",text:Craft.t("app","Done")}).appendTo(s);this.settingsModal=new Garnish.Modal(i,{onHide:t.proxy(this,"handleSettingsModalHide")}),this.addListener(o,"click",(function(){this.settingsModal.hide()}))}setTimeout(t.proxy((function(){this.optionsTable.$tbody.find("textarea").first().trigger("focus")}),this),100)},handleOptionsRowChange:function(){this.settingsModal&&this.settingsModal.updateSizeAndPosition()},handleSettingsModalHide:function(){this.options=[];for(var t=this.optionsTable.$table.find("tbody tr"),e=0;e<t.length;e++){var n=t.eq(e);this.options.push({label:n.find(".option-label textarea").val(),value:n.find(".option-value textarea").val(),default:n.find(".option-default input[type=checkbox]").prop("checked")})}this.table.fieldSettings.reconstructDefaultsTable()},handleFormSubmit:function(e){"select"===this.$typeSelect.val()&&t("<input/>",{type:"hidden",name:this.table.fieldSettings.columnsTableName+"["+this.id+"][options]",value:JSON.stringify(this.options)}).appendTo(e.currentTarget)}})}(jQuery)}]);
//# sourceMappingURL=TableFieldSettings.min.js.map
!function(t){var e={};function i(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(r,s,function(e){return t[e]}.bind(null,s));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var r,s,n,a;i(1);r=jQuery,s=Garnish.Base.extend({tokens:null,routes:null,$container:null,$addRouteBtn:null,sorter:null,init:function(){this.tokens={},this.routes=[],this.$container=r("#routes");for(var t=this.getRoutes(),e=0;e<t.length;e++){var i=new n(t[e]);this.routes.push(i)}this.sorter=new Garnish.DragSort(t,{axis:Garnish.Y_AXIS,onSortChange:r.proxy(this,"updateRouteOrder")}),this.$addRouteBtn=r("#add-route-btn"),this.addListener(this.$addRouteBtn,"click","addRoute")},getRoutes:function(){return this.$container.children()},updateRouteOrder:function(){for(var t=this.getRoutes(),e={},i=0;i<t.length;i++)e["routeUids["+i+"]"]=r(t[i]).attr("data-uid");Craft.postActionRequest("routes/update-route-order",e,r.proxy((function(t,e){"success"===e&&(t.success?Craft.cp.displayNotice(Craft.t("app","New route order saved.")):Craft.cp.displayError(Craft.t("app","Couldn’t save new route order.")))}),this))},addRoute:function(){new a}}),n=Garnish.Base.extend({$container:null,uid:null,siteUid:null,$siteLabel:null,$uri:null,$template:null,modal:null,init:function(t){this.$container=r(t),this.uid=this.$container.data("uid"),this.siteUid=this.$container.data("site-uid"),this.$siteLabel=this.$container.find(".site:first"),this.$uri=this.$container.find(".uri:first"),this.$template=this.$container.find(".template:first"),this.addListener(this.$container,"click","edit")},edit:function(){this.modal?this.modal.show():this.modal=new a(this)},updateHtmlFromModal:function(){var t;if(Craft.isMultiSite)if(this.siteUid){for(t=0;t<Craft.sites.length;t++)if(Craft.sites[t].uid==this.siteUid){this.$siteLabel.text(Craft.sites[t].name);break}}else this.$siteLabel.text(Craft.t("app","Global"));var e="";for(t=0;t<this.modal.uriInput.elements.length;t++){var i=this.modal.uriInput.elements[t];this.modal.uriInput.isText(i)?e+=Craft.escapeHtml(i.val()):e+=i.prop("outerHTML")}this.$uri.html(e),this.$template.text(this.modal.$templateInput.val())}}),a=Garnish.Modal.extend({route:null,$heading:null,$uriInput:null,$uriErrors:null,uriElements:null,$templateInput:null,$saveBtn:null,$cancelBtn:null,$spinner:null,$deleteBtn:null,loading:!1,init:function(t){this.route=t;var e="<h4>"+Craft.t("app","Add a token")+"</h4>";for(var i in Craft.routes.tokens)Craft.routes.tokens.hasOwnProperty(i)&&(e+='<div class="token" data-name="'+i+'" data-value="'+Craft.routes.tokens[i]+'"><span>'+i+"</span></div>");var s,n='<form class="modal fitted route-settings" accept-charset="UTF-8"><div class="header"><h1></h1></div><div class="body"><div class="uri-field field"><div class="heading"><label for="uri">'+Craft.t("app","If the URI looks like this")+':</label></div><div class="input">';if(Craft.isMultiSite&&(n+='<div class="flex"><div class="flex-grow">'),n+='<div id="uri" class="text uri ltr"></div>',Craft.isMultiSite){for(n+='</div><div class="select"><select class="site"><option value="">'+Craft.t("app","Global")+"</option>",s=0;s<Craft.sites.length;s++){var a=Craft.sites[s];n+='<option value="'+a.uid+'">'+Craft.escapeHtml(a.name)+"</option>"}n+="</select></div></div>"}n+='</div><div class="uri-tokens">'+e+'</div></div><div class="template-field field"><div class="heading"><label for="template">'+Craft.t("app","Load this template")+':</label></div><div class="input"><input id="template" type="text" class="text fullwidth template ltr"></div></div></div><div class="footer"><div class="buttons right last"><button type="button" class="btn cancel">'+Craft.t("app","Cancel")+'</button><button type="submit" class="btn submit">'+Craft.t("app","Save")+'</button><div class="spinner" style="display: none;"></div></div><a class="delete">'+Craft.t("app","Delete")+"</a></div></form>";var o=r(n).appendTo(Garnish.$bod);if(this.$heading=o.find("h1:first"),this.$siteInput=o.find(".site:first"),this.$uriInput=o.find(".uri:first"),this.$templateInput=o.find(".template:first"),this.$saveBtn=o.find(".submit:first"),this.$cancelBtn=o.find(".cancel:first"),this.$spinner=o.find(".spinner:first"),this.$deleteBtn=o.find(".delete:first"),this.route||this.$deleteBtn.hide(),this.uriInput=new Garnish.MixedInput(this.$uriInput,{dir:"ltr"}),this.route?this.$heading.html(Craft.t("app","Edit Route")):this.$heading.html(Craft.t("app","Create a new route")),this.route){this.$siteInput.val(this.route.siteUid);var u=this.route.$uri.prop("childNodes");for(s=0;s<u.length;s++){var d=u[s];Garnish.isTextNode(d)?this.uriInput.addTextElement().setVal(d.nodeValue):this.addUriVar(d)}var l=this.route.$template.text();this.$templateInput.val(l)}this.base(o);var h=this.$container.find(".uri-tokens").children("div");this.addListener(h,"mousedown",(function(t){this.addUriVar(t.currentTarget)})),this.addListener(this.$container,"submit","saveRoute"),this.addListener(this.$cancelBtn,"click","cancel"),this.addListener(this.$deleteBtn,"click","deleteRoute")},addUriVar:function(t){var e=r(t).clone().attr("tabindex","0");this.uriInput.addElement(e),this.addListener(e,"keydown",(function(t){switch(t.keyCode){case Garnish.LEFT_KEY:setTimeout(r.proxy((function(){this.uriInput.focusPreviousElement(e)}),this),1);break;case Garnish.RIGHT_KEY:setTimeout(r.proxy((function(){this.uriInput.focusNextElement(e)}),this),1);break;case Garnish.DELETE_KEY:setTimeout(r.proxy((function(){this.uriInput.removeElement(e)}),this),1),t.preventDefault()}}))},show:function(){this.route&&(this.$heading.html(Craft.t("app","Edit Route")),this.$deleteBtn.show()),setTimeout(function(){if(this.uriInput.elements.length){var t=this.uriInput.elements[0];this.uriInput.setFocus(t),this.uriInput.setCarotPos(t,0)}else this.$uriInput.trigger("focus")}.bind(this),100),this.base()},saveRoute:function(t){if(t.preventDefault(),!this.loading){this.$container.find(".uri-field .input").removeClass("errors"),this.$uriErrors&&(this.$uriErrors.remove(),this.$uriErrors=null);var e,i,s={siteUid:this.$siteInput.val()};this.route&&(s.routeUid=this.route.uid);for(var a=0;a<this.uriInput.elements.length;a++)if(e=this.uriInput.elements[a],this.uriInput.isText(e)){if(i=e.val(),0===a){if(i=Craft.ltrim(i,"/"),Craft.startsWith(i,Craft.actionTrigger+"/"))return void this.addUriError(Craft.t("app","The URI can’t begin with the {setting} config setting.",{setting:"actionTrigger"}));if(Craft.cpTrigger&&Craft.startsWith(i,Craft.cpTrigger+"/"))return void this.addUriError(Craft.t("app","The URI can’t begin with the {setting} config setting.",{setting:"cpTrigger"}))}s["uriParts["+a+"]"]=i}else s["uriParts["+a+"][0]"]=e.attr("data-name"),s["uriParts["+a+"][1]"]=e.attr("data-value");s.template=this.$templateInput.val(),this.loading=!0,this.$saveBtn.addClass("active"),this.$spinner.show(),Craft.postActionRequest("routes/save-route",s,r.proxy((function(t,e){if(this.$saveBtn.removeClass("active"),this.$spinner.hide(),this.loading=!1,"success"===e)if(t.success){if(!this.route){var i='<div class="route" data-uid="'+t.routeUid+'"'+(t.siteUid?' data-site-uid="'+t.siteUid+'"':"")+'><div class="uri-container">';Craft.isMultiSite&&(i+='<span class="site"></span>');var s=r(i+='<span class="uri" dir="ltr"></span></div><div class="template" dir="ltr"></div></div>');s.appendTo("#routes"),this.route=new n(s),this.route.modal=this,Craft.routes.sorter.addItems(s),1===Craft.routes.sorter.$items.length&&r("#noroutes").addClass("hidden")}this.route.siteUid=t.siteUid,this.route.updateHtmlFromModal(),this.hide(),Craft.cp.displayNotice(Craft.t("app","Route saved."))}else t.errors?t.errors.uri:Craft.cp.displayError(Craft.t("app","Couldn’t save route."))}),this))}},addUriError:function(t){this.$container.find(".uri-field .input").addClass("errors"),this.$uriErrors?Craft.ui.addErrorsToList(this.$uriErrors,[t]):(this.$uriErrors=Craft.ui.createErrorList([t]),this.$uriErrors.insertAfter(this.$container.find(".uri-field .input")))},cancel:function(){this.hide(),this.route&&(this.route.modal=null)},deleteRoute:function(){confirm(Craft.t("app","Are you sure you want to delete this route?"))&&(Craft.postActionRequest("routes/delete-route",{routeUid:this.route.uid},(function(t,e){"success"===e&&Craft.cp.displayNotice(Craft.t("app","Route deleted."))})),Craft.routes.sorter.removeItems(this.route.$container),this.route.$container.remove(),this.hide(),0===Craft.routes.sorter.$items.length&&r("#noroutes").removeClass("hidden"))}}),Craft.routes=new s},function(t,e,i){var r=i(2);"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);(0,i(3).default)("600344e6",r,!1,{})},function(t,e,i){},function(t,e,i){"use strict";function r(t,e){for(var i=[],r={},s=0;s<e.length;s++){var n=e[s],a=n[0],o={id:t+":"+s,css:n[1],media:n[2],sourceMap:n[3]};r[a]?r[a].parts.push(o):i.push(r[a]={id:a,parts:[o]})}return i}i.r(e),i.d(e,"default",(function(){return c}));var s="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!s)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var n={},a=s&&(document.head||document.getElementsByTagName("head")[0]),o=null,u=0,d=!1,l=function(){},h=null,f="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function c(t,e,i,s){d=i,h=s||{};var a=r(t,e);return p(a),function(e){for(var i=[],s=0;s<a.length;s++){var o=a[s];(u=n[o.id]).refs--,i.push(u)}e?p(a=r(t,e)):a=[];for(s=0;s<i.length;s++){var u;if(0===(u=i[s]).refs){for(var d=0;d<u.parts.length;d++)u.parts[d]();delete n[u.id]}}}}function p(t){for(var e=0;e<t.length;e++){var i=t[e],r=n[i.id];if(r){r.refs++;for(var s=0;s<r.parts.length;s++)r.parts[s](i.parts[s]);for(;s<i.parts.length;s++)r.parts.push(m(i.parts[s]));r.parts.length>i.parts.length&&(r.parts.length=i.parts.length)}else{var a=[];for(s=0;s<i.parts.length;s++)a.push(m(i.parts[s]));n[i.id]={id:i.id,refs:1,parts:a}}}}function v(){var t=document.createElement("style");return t.type="text/css",a.appendChild(t),t}function m(t){var e,i,r=document.querySelector('style[data-vue-ssr-id~="'+t.id+'"]');if(r){if(d)return l;r.parentNode.removeChild(r)}if(f){var s=u++;r=o||(o=v()),e=$.bind(null,r,s,!1),i=$.bind(null,r,s,!0)}else r=v(),e=b.bind(null,r),i=function(){r.parentNode.removeChild(r)};return e(t),function(r){if(r){if(r.css===t.css&&r.media===t.media&&r.sourceMap===t.sourceMap)return;e(t=r)}else i()}}var g,C=(g=[],function(t,e){return g[t]=e,g.filter(Boolean).join("\n")});function $(t,e,i,r){var s=i?"":r.css;if(t.styleSheet)t.styleSheet.cssText=C(e,s);else{var n=document.createTextNode(s),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(n,a[e]):t.appendChild(n)}}function b(t,e){var i=e.css,r=e.media,s=e.sourceMap;if(r&&t.setAttribute("media",r),h.ssrId&&t.setAttribute("data-vue-ssr-id",e.id),s&&(i+="\n/*# sourceURL="+s.sources[0]+" */",i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}}]);
//# sourceMappingURL=routes.min.js.map